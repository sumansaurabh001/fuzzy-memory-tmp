<ng-container *ngIf="(course$| async) as course">

  <ng-container *ngIf="(lessons$ | async) as lessons">

    <div class="playlist" *ngIf="leftMenuOpened">

      <mat-slide-toggle
        color="primary"
        class="autoplay"
        [(ngModel)]="autoPlay"
        (change)="onAutoPlayChange()">
        Autoplay
      </mat-slide-toggle>

      <ng-container *ngIf="(activeLesson$ | async) as activeLesson">

        <course-content
          [playlistMode]="true"
          [course]="course"
          [sections]="sections$ | async"
          [lessons]="lessons"
          [lessonsWatched]="lessonsWatched$ | async"
          [activeLesson]="activeLesson">

        </course-content>

      </ng-container>

    </div>

    <div class="video-panel">

      <ng-container *ngIf="(lessonData$ | async) as lessonData">

        <video-player *ngIf="lessonData[1].status == 'allowed'; else videoNotAllowed"
                      #videoPlayer
                      class="lesson-video mat-elevation-z7"
                      [url]="ub.buildLessonVideoUrl(course, lessonData[0], lessonData[1])"
                      [videoDuration]="lessonData[0].videoDuration"
                      [allowDownload]="course.downloadAllowed"
                      (close)="toggleLeftMenu()"
                      (open)="toggleLeftMenu()"
                      (exit)="onExit(course)"
                      (videoEnded)="onVideoEnded(lessons, lessonData[0])"
                      (videoWatched)="onVideoWatched(course, lessonData[0])">

        </video-player>

        <ng-template #videoNotAllowed>
          <p>TODO - user cannot watch video.</p>
        </ng-template>

        <div class="questions">

          <h1 class="page-title">Questions & Answers</h1>

          <search class="search-questions" placeholder="Search all course questions" width="300px"></search>

          <mat-button-toggle-group name="questionGroup" aria-label="Question Group">
            <mat-button-toggle value="currentLesson" [checked]="true">Current Lesson Questions</mat-button-toggle>
            <mat-button-toggle value="fullCourse">All Course Questions</mat-button-toggle>
          </mat-button-toggle-group>

        </div>

        <div class="ask-question-button">
          <span class="button-text">Ask a New Question:</span>
          <button mat-fab color="accent" (click)="askNewQuestion()">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <questions-list [questions]="questions$ | async"></questions-list>

      </ng-container>

    </div>

  </ng-container>

</ng-container>
