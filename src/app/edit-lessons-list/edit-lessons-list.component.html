<ng-container *ngIf="(course$ | async) as course">

  <ng-container *ngIf="(sections$ | async) as sections">

    <edit-lessons-toolbar *ngIf="isCourseLoaded$ | async">

      <action-button text="Bulk Upload" icon="cloud_upload"></action-button>

      <action-button *ngIf="sections.length > 0" text="Preview Course" icon="remove_red_eye" color="basic"
                     [routerLink]="['/courses', course.url]"></action-button>

      <action-button *ngIf="course.status == 'draft' && sections?.length == 0"
                     text="Delete Course Draft" color="secondary"
                     icon="delete" (click)="deleteCourseDraft(course)">
      </action-button>

    </edit-lessons-toolbar>

    <div class="drag-drop-container" cdkDropList (cdkDropListDropped)="dropLesson(course, sections, $event)">

      <ng-container *ngFor="let section of sections">

        <div class="course-section mat-elevation-z7">

          <div class="section-title">
            <span class="section-number">Section {{section.seqNo}}: </span>
            <span class="section-title-text" (click)="editSectionTitle(course,section)"> {{section.title}}</span>

            <div class="edit-button-container"(click)="editSectionTitle(course,section)">
              <mat-icon>edit</mat-icon>
            </div>

            <div class="filler draggable"></div>

            <mat-icon class="drag-section draggable">drag_handle</mat-icon>
          </div>

          <ng-container *ngIf="(allLessons$ | async) as allLessons">

            <div class="lessons-container" *ngIf="findLessonsForSection(section, allLessons) as lessons">

              <edit-lesson-list-item
                *ngFor="let lesson of lessons; let index = index"
                [lesson]="lesson"
                [course]="course"
                [index]="index"
                [expanded]="expandedLessons[lesson.id]"
                (expandChanged)="onExpandLesson(lesson, $event)"
                cdkDrag>

              </edit-lesson-list-item>

              <div class="bottom-toolbar">

                <action-button
                  color="accent" icon="delete" color="secondary" (click)="deleteSection(course, section)"
                  title="Delete empty section" *ngIf="lessons?.length == 0">

                </action-button>

                <div class="filler"></div>

                <action-button class="add-lesson" text="Add Lesson" color="accent" icon="add"
                               (click)="addLesson(course, section)"></action-button>

              </div>

            </div>

          </ng-container>

        </div>

      </ng-container>

    </div>

    <div class="add-button-panel add-section-panel" [ngClass]="emptyCourseCss(course, sections)" *ngIf="isCourseLoaded$ | async">

      <span>Add Course Section</span>
      <button class="add-section" mat-fab color="accent" (click)="addSection(course)">
        <mat-icon>add</mat-icon>
      </button>
    </div>

  </ng-container>

</ng-container>


